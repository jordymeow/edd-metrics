!function(e,a,t,s){var r={};r.init=function(){r.compare_temp_2=e.eddMetrics.compare_string_2,r.revenue=e.eddMetrics.revenue,r.downloads=e.eddMetrics.downloads,r.doCal()},r.doCal=function(){new Calendar({element:t(".metrics-datepicker"),presets:[{label:"Last 30 days",start:moment().subtract(29,"days"),end:moment()},{label:"This month",start:moment().startOf("month"),end:moment().endOf("month")},{label:"Last month",start:moment().subtract(1,"month").startOf("month"),end:moment().subtract(1,"month").endOf("month")},{label:"Last 7 days",start:moment().subtract(6,"days"),end:moment()},{label:"Last 3 months",start:moment(this.latest_date).subtract(3,"month").startOf("month"),end:moment(this.latest_date).subtract(1,"month").endOf("month")}],earliest_date:"January 1, 2006",latest_date:moment(),start_date:moment().subtract(29,"days"),end_date:moment(),callback:r.callback}).calendarSaveDates()},r.callback=function(){var a={action:"metrics_batch_1",start:moment(this.start_date).format("LL"),end:moment(this.end_date).format("LL")},s='<div id="circleG"><div id="circleG_1" class="circleG"></div><div id="circleG_2" class="circleG"></div><div id="circleG_3" class="circleG"></div></div>';t(".edd-metrics-box h2").html(s),t(".edd-metrics-box .bottom-text span").html("").removeClass(),t(this.element[0]).hasClass("metrics-detail")?(t(".edd-metrics-chart-wrapper").append(s),t.post(e.ajaxurl,a,r.detailResponse).then(function(){a.action="metrics_batch_2",t.post(e.ajaxurl,a,r.detailResponse_2)}).fail(function(){console.warn("ajax error")})):t.post(e.ajaxurl,a,r.dashResponse).then(function(){a.action="metrics_batch_2",t.post(e.ajaxurl,a,r.batch2response)}).fail(function(){console.warn("ajax error")})},r.dashResponse=function(a){var s=JSON.parse(a),r=e.eddMetrics.compare_string+" "+s.dates.num_days+" "+e.eddMetrics.days;t("#revenue").html(s.earnings.total),t("#revenue-compare span").html(s.earnings.compare.percentage+r).removeClass().addClass(s.earnings.compare.classes),t("#sales").html(s.sales.count),t("#sales-compare span").html(s.sales.compare.percentage+r).removeClass().addClass(s.sales.compare.classes),t("#avgpercust").html(s.earnings.avgpercust.total),t("#avgpercust-compare span").html(s.earnings.avgpercust.compare.percentage+r).removeClass().addClass(s.earnings.avgpercust.compare.classes),t("#refunds").html(s.earnings.refunds.count),t("#refund-amount").html(s.earnings.refunds.losses),t("#refunds-compare span").html(s.earnings.refunds.compare.percentage+r).removeClass().addClass(s.earnings.refunds.compare.classes)},r.batch2response=function(a){var s=JSON.parse(a),r=e.eddMetrics.compare_string+" "+s.dates.num_days+" "+e.eddMetrics.days;t("#earnings-today").html(s.earnings.detail.today),t("#renewals").length&&(t("#renewals").html(s.renewals.count),t("#renewal-amount").html(s.renewals.earnings),t("#renewals-compare span").html(s.renewals.compare.percentage+r).removeClass().addClass(s.renewals.compare.classes)),t("#subscriptions").length&&(t("#subscriptions").html(s.subscriptions.number.count),t("#subscriptions-compare span").html(s.subscriptions.number.compare.percentage+r).removeClass().addClass(s.subscriptions.number.compare.classes),t("#recurring-revenue").html(s.subscriptions.earnings.total),t("#recurring-revenue-30").html(s.subscriptions.earnings30),t("#recurring-revenue-1y").html(s.subscriptions.earnings1y)),t("#discounts").html(s.discounts.now.amount),t("#discounts-count").html(s.discounts.now.count),t("#discounts-compare span").html(s.discounts.compare.percentage+r).removeClass().addClass(s.discounts.compare.classes),t("#commissions").length&&(t("#commissions").html(s.commissions.count),t("#commissions-amount").html(s.commissions.earnings))},r.detailResponse=function(e){var a=JSON.parse(e);switch(r.getQueryVariable("metric")){case"revenue":t("#revenue").html(a.earnings.total),t("#revenue-compare span").html(a.earnings.compare.percentage+r.compare_temp_2).removeClass().addClass(a.earnings.compare.classes),t(".detail-compare-first").html(a.earnings.compare.total),t("#monthly h2").html(a.earnings.avgmonthly.earnings),t("#new-customers h2").html(a.earnings.avgpercust.current_customers),t("#new-customers span").html("This period"),t(".detail-compare-first").html(a.earnings.compare.total),t("#box-4 .bottom-text span").html(a.earnings.compare.percentage+"%")}r.doLineChart(a.lineChart),t(".edd-metrics-chart-wrapper #circleG").remove()},r.detailResponse_2=function(e){var a=JSON.parse(e);switch(r.getQueryVariable("metric")){case"revenue":t("#revenue-6mocompare span").html(a.earnings.detail.sixmoago.compare+r.compare_temp_2).removeClass().addClass(a.earnings.detail.sixmoago.classes),t(".detail-compare-second").html(a.earnings.detail.sixmoago.total),t(".detail-compare-third").html(a.earnings.detail.twelvemoago.total),t("#revenue-12mocompare span").html(a.earnings.detail.twelvemoago.compare+r.compare_temp_2).removeClass().addClass(a.earnings.detail.twelvemoago.classes),t("#earnings-today h2").html(a.earnings.detail.today),t("#earnings-this-month h2").html(a.earnings.detail.this_month),t("#renewal-rate h2").html(a.yearly_renewal_rate.percent+"%"),t("#yearly-renewal-compare span").html("Last "+a.yearly_renewal_rate.period+" days"),t("#box-5 .bottom-text span").html(a.earnings.detail.sixmoago.compare+"%"),t(".detail-compare-second").html(a.earnings.detail.sixmoago.total),t(".detail-compare-third").html(a.earnings.detail.twelvemoago.total)}r.doDownloadChart(a.pieChart),r.doGatewayChart(a.earnings.gateways)},r.getQueryVariable=function(a){for(var t=e.location.search.substring(1).split("&"),s=0;s<t.length;s++){var r=t[s].split("=");if(r[0]==a)return r[1]}return!1},r.doLineChart=function(e){r.lineChart&&r.lineChart.destroy();var t={labels:e.labels,datasets:[{label:r.revenue,fill:!0,lineTension:.1,backgroundColor:"rgba(0,115,170,.2)",borderColor:"#0073aa",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"#0073aa",pointBackgroundColor:"#fff",pointBorderWidth:2,pointHoverRadius:5,pointHoverBackgroundColor:"#0073aa",pointHoverBorderColor:"rgba(220,220,220,1)",pointHoverBorderWidth:2,pointRadius:4,pointHitRadius:10,data:e.earnings,spanGaps:!1}]},s=a.getElementById("metrics-line-chart");r.lineChart=new Chart(s,{type:"line",data:t,options:{scales:{xAxes:[{display:!1,stacked:!0}]}}})},r.doDownloadChart=function(e){r.downloadChart&&r.downloadChart.destroy();var t={labels:e.labels,datasets:[{label:r.downloads,data:e.earnings,backgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"],hoverBackgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"]}]},s=a.getElementById("metrics-piechart-by-download");r.downloadChart=new Chart(s,{type:"pie",data:t})},r.doGatewayChart=function(e){r.gatewayChart&&r.gatewayChart.destroy();var t={labels:e.labels,datasets:[{label:r.downloads,data:e.earnings,backgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"],hoverBackgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"]}]},s=a.getElementById("metrics-piechart-by-gateway");r.gatewayChart=new Chart(s,{type:"pie",data:t})},jQuery(a).ready(r.init)}(window,document,jQuery);
